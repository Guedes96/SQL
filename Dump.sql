/*============================================================ GERAR DUMP ============================================================================*/
--DROP TABLE #BASE
SELECT
	'3'																AS COD_CREDOR,
	NM_CLIENTE_CEDENTE												AS CPF,
	CONVERT(VARCHAR(20),DT_ACAO,20)									AS RESPONSE_DTTM,
	NM_ACAO_CEDENTE													AS RESPONSE_CHANNEL_RESPONSE_CD,
	'1'																AS EXTERNAL_RESPONSE_INFO_ID1,
	'VER'															AS EXTERNAL_RESPONSE_INFO_ID2,
	''																AS CHANNEL_CD,
	''																AS RESPONSE_TRACKING_CD,
	''																AS TREATMENT_TRACKING_CD,
	NM_ACAO															AS OCORRENCIA_ORIGINAL,
	(CAST(NU_DDD as varchar) + CAST(NU_TELEFONE as varchar))		AS DDD_TELEFONE,
	U.ID_USUARIO													AS USUARIO
--INTO #BASE
FROM TB_CLIENTE C
		RIGHT JOIN TB_CLIENTE_ACAO CA		ON CA.ID_CLIENTE = C.ID_CLIENTE
		INNER JOIN TB_ACAO A				ON A.ID_ACAO = CA.ID_ACAO
		INNER JOIN TB_ACAO_CEDENTE AC		ON AC.ID_ACAO = CA.ID_ACAO
		INNER JOIN TB_USUARIO U				ON U.ID_USUARIO = CA.ID_USUARIO
WHERE CAST(DT_ACAO AS DATE) = CAST((GETDATE() - 10) AS DATE)
AND C.ID_CEDENTE = 1
AND AC.ID_CEDENTE = 1
AND NU_TELEFONE IS NOT NULL
AND NM_ACAO_CEDENTE IS NOT NULL
AND NM_ACAO LIKE 'ATV%'
--ORDER BY 3
UNION
SELECT 
	'3'																AS COD_CREDOR,
	NM_CLIENTE_CEDENTE												AS CPF,
	CONVERT(VARCHAR(20),DT_ACAO,20)									AS RESPONSE_DTTM,
	NM_ACAO_CEDENTE													AS RESPONSE_CHANNEL_RESPONSE_CD,
	'1'																AS EXTERNAL_RESPONSE_INFO_ID1,
	'VER' 															AS EXTERNAL_RESPONSE_INFO_ID2,
	'' 																AS CHANNEL_CD,
	'' 																AS RESPONSE_TRACKING_CD,
	'' 																AS TREATMENT_TRACKING_CD,
	NM_ACAO 														AS OCORRENCIA_ORIGINAL,
	(CAST(NU_DDD as varchar) + CAST(NU_TELEFONE as varchar))		AS DDD_TELEFONE,
	--''															AS USUARIO
	USUARIO = CAST(NULL AS INT) 
FROM TB_CLIENTE C
	RIGHT JOIN TB_CLIENTE_ACAO CA		ON CA.ID_CLIENTE = C.ID_CLIENTE
	INNER JOIN TB_ACAO A				ON A.ID_ACAO = CA.ID_ACAO
	INNER JOIN TB_ACAO_CEDENTE AC		ON AC.ID_ACAO = CA.ID_ACAO
	INNER JOIN TB_USUARIO U				ON U.ID_USUARIO = CA.ID_USUARIO
WHERE CAST(DT_ACAO AS DATE) = CAST((GETDATE() - 10) AS DATE)
AND C.ID_CEDENTE = 1
AND AC.ID_CEDENTE = 1
AND NU_TELEFONE IS NOT NULL
AND NM_ACAO_CEDENTE IS NOT NULL
AND NM_ACAO NOT LIKE 'ATV%'



/*============================================================ DELETANDO DUMP DA DATA GERADA ============================================================================*/
DELETE FROM TB_RENNER_EXPORTA_DUMP 
WHERE CAST(RESPONSE_DTTM AS DATE) = CAST((GETDATE() - 3) AS DATE)

/*=================================================== INPUTANDO DUMP DA DATA GERADA NA TABELA TEMP #BASE ============================================================================*/
INSERT INTO TB_RENNER_EXPORTA_DUMP 
SELECT * FROM #BASE 



SELECT CAST(GETDATE() - 13 AS DATE) 







































/*SELECT 
	  COUNT(1) 
	, CAST(RESPONSE_DTTM AS DATE) 
FROM TB_RENNER_EXPORTA_DUMP 
GROUP BY RESPONSE_DTTM 
ORDER BY RESPONSE_DTTM 

--SELECT CAST(GETDATE()-8 AS DATE)

SELECT * FROM TB_RENNER_EXPORTA_DUMP 
WHERE CAST(RESPONSE_DTTM AS DATE) = CAST(GETDATE() -13 AS DATE) 
ORDER BY CAST(RESPONSE_DTTM AS DATE) 



SELECT
        DATA = CAST(DATA AS DATE) 
      , ID_CLIENTE 
FROM CEA_PAY_HORA_HORA
WHERE DATA >= CAST(GETDATE() - DATEPART(DD,GETDATE() -1) AS DATE) 
AND ID_USUARIO <> '4'

use easycollector
select id_usuario , NM_LOGIN_DISCADOR, NM_INFORMACAO_ADICIONAL from tb_usuario where nm_login_discador = '53811803816' 
*/